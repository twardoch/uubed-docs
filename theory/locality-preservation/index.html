<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Position-safe encoding for substring-based search systems"><meta name=author content="uubed Contributors"><link href=https://uubed.readthedocs.io/theory/locality-preservation/ rel=canonical><link href=../quadb64-fundamentals/ rel=prev><link href=../visual-diagrams/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>Locality Preservation - The QuadB64 Codex</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../css/timeago.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#chapter-4-locality-preservation-mathematical-foundations class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="The QuadB64 Codex" class="md-header__button md-logo" aria-label="The QuadB64 Codex" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-8 5H9v2c0 1.1-.9 2-2 2 1.1 0 2 .9 2 2v2h2v2H9c-1.1 0-2-.9-2-2v-1c0-1.1-.9-2-2-2v-2c1.1 0 2-.9 2-2V8c0-1.1.9-2 2-2h2zm8 5c-1.1 0-2 .9-2 2v1c0 1.1-.9 2-2 2h-2v-2h2v-2c0-1.1.9-2 2-2-1.1 0-2-.9-2-2V8h-2V6h2c1.1 0 2 .9 2 2v1c0 1.1.9 2 2 2z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The QuadB64 Codex </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Locality Preservation </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=indigo aria-label="Switch to auto mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to auto mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/twardoch/uubed title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> twardoch/uubed </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../quickstart/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../introduction/ class=md-tabs__link> Theory </a> </li> <li class=md-tabs__item> <a href=../../family/overview/ class=md-tabs__link> QuadB64 Family </a> </li> <li class=md-tabs__item> <a href=../../performance/optimization/ class=md-tabs__link> Performance </a> </li> <li class=md-tabs__item> <a href=../../applications/overview/ class=md-tabs__link> Applications </a> </li> <li class=md-tabs__item> <a href=../../api/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../interactive/encoding-playground/ class=md-tabs__link> Interactive </a> </li> <li class=md-tabs__item> <a href=../../implementation/architecture/ class=md-tabs__link> Advanced </a> </li> <li class=md-tabs__item> <a href=../../contributing/setup.md class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="The QuadB64 Codex" class="md-nav__button md-logo" aria-label="The QuadB64 Codex" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-8 5H9v2c0 1.1-.9 2-2 2 1.1 0 2 .9 2 2v2h2v2H9c-1.1 0-2-.9-2-2v-1c0-1.1-.9-2-2-2v-2c1.1 0 2-.9 2-2V8c0-1.1.9-2 2-2h2zm8 5c-1.1 0-2 .9-2 2v1c0 1.1-.9 2-2 2h-2v-2h2v-2c0-1.1.9-2 2-2-1.1 0-2-.9-2-2V8h-2V6h2c1.1 0 2 .9 2 2v1c0 1.1.9 2 2 2z"/></svg> </a> The QuadB64 Codex </label> <div class=md-nav__source> <a href=https://github.com/twardoch/uubed title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> twardoch/uubed </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../quickstart/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Theory </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Theory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../base64-evolution/ class=md-nav__link> <span class=md-ellipsis> Base64 Evolution </span> </a> </li> <li class=md-nav__item> <a href=../quadb64-fundamentals/ class=md-nav__link> <span class=md-ellipsis> QuadB64 Fundamentals </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Locality Preservation </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Locality Preservation </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-principle-of-locality-in-encoding class=md-nav__link> <span class=md-ellipsis> The Principle of Locality in Encoding </span> </a> </li> <li class=md-nav__item> <a href=#defining-locality-preservation class=md-nav__link> <span class=md-ellipsis> Defining Locality Preservation </span> </a> <nav class=md-nav aria-label="Defining Locality Preservation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mathematical-definition class=md-nav__link> <span class=md-ellipsis> Mathematical Definition </span> </a> </li> <li class=md-nav__item> <a href=#practical-interpretation class=md-nav__link> <span class=md-ellipsis> Practical Interpretation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#locality-in-the-quadb64-family class=md-nav__link> <span class=md-ellipsis> Locality in the QuadB64 Family </span> </a> <nav class=md-nav aria-label="Locality in the QuadB64 Family"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#eq64-structural-locality class=md-nav__link> <span class=md-ellipsis> Eq64: Structural Locality </span> </a> </li> <li class=md-nav__item> <a href=#shq64-cosine-similarity-preservation class=md-nav__link> <span class=md-ellipsis> Shq64: Cosine Similarity Preservation </span> </a> </li> <li class=md-nav__item> <a href=#t8q64-feature-overlap-preservation class=md-nav__link> <span class=md-ellipsis> T8q64: Feature Overlap Preservation </span> </a> </li> <li class=md-nav__item> <a href=#zoq64-spatial-locality class=md-nav__link> <span class=md-ellipsis> Zoq64: Spatial Locality </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mathematical-analysis class=md-nav__link> <span class=md-ellipsis> Mathematical Analysis </span> </a> <nav class=md-nav aria-label="Mathematical Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metric-preservation-properties class=md-nav__link> <span class=md-ellipsis> Metric Preservation Properties </span> </a> </li> <li class=md-nav__item> <a href=#quantitative-analysis class=md-nav__link> <span class=md-ellipsis> Quantitative Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experimental-validation class=md-nav__link> <span class=md-ellipsis> Experimental Validation </span> </a> <nav class=md-nav aria-label="Experimental Validation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#embedding-similarity-preservation class=md-nav__link> <span class=md-ellipsis> Embedding Similarity Preservation </span> </a> </li> <li class=md-nav__item> <a href=#nearest-neighbor-preservation class=md-nav__link> <span class=md-ellipsis> Nearest Neighbor Preservation </span> </a> </li> <li class=md-nav__item> <a href=#clustering-quality class=md-nav__link> <span class=md-ellipsis> Clustering Quality </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#practical-implications class=md-nav__link> <span class=md-ellipsis> Practical Implications </span> </a> <nav class=md-nav aria-label="Practical Implications"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#search-quality-enhancement class=md-nav__link> <span class=md-ellipsis> Search Quality Enhancement </span> </a> </li> <li class=md-nav__item> <a href=#index-efficiency class=md-nav__link> <span class=md-ellipsis> Index Efficiency </span> </a> </li> <li class=md-nav__item> <a href=#machine-learning-applications class=md-nav__link> <span class=md-ellipsis> Machine Learning Applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-topics class=md-nav__link> <span class=md-ellipsis> Advanced Topics </span> </a> <nav class=md-nav aria-label="Advanced Topics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#locality-sensitive-hashing-theory class=md-nav__link> <span class=md-ellipsis> Locality-Sensitive Hashing Theory </span> </a> </li> <li class=md-nav__item> <a href=#information-theoretic-bounds class=md-nav__link> <span class=md-ellipsis> Information-Theoretic Bounds </span> </a> </li> <li class=md-nav__item> <a href=#geometric-interpretation class=md-nav__link> <span class=md-ellipsis> Geometric Interpretation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#future-directions class=md-nav__link> <span class=md-ellipsis> Future Directions </span> </a> <nav class=md-nav aria-label="Future Directions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#adaptive-locality class=md-nav__link> <span class=md-ellipsis> Adaptive Locality </span> </a> </li> <li class=md-nav__item> <a href=#quantum-extensions class=md-nav__link> <span class=md-ellipsis> Quantum Extensions </span> </a> </li> <li class=md-nav__item> <a href=#continuous-optimization class=md-nav__link> <span class=md-ellipsis> Continuous Optimization </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../visual-diagrams/ class=md-nav__link> <span class=md-ellipsis> Visual Diagrams </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../family/overview/ class=md-nav__link> <span class=md-ellipsis> QuadB64 Family </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../performance/optimization/ class=md-nav__link> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../applications/overview/ class=md-nav__link> <span class=md-ellipsis> Applications </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api/ class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../interactive/encoding-playground/ class=md-nav__link> <span class=md-ellipsis> Interactive </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../implementation/architecture/ class=md-nav__link> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../contributing/setup.md class=md-nav__link> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/twardoch/uubed/edit/main/docs/theory/locality-preservation.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/twardoch/uubed/raw/main/docs/theory/locality-preservation.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=chapter-4-locality-preservation-mathematical-foundations>Chapter 4: Locality Preservation - Mathematical Foundations<a class=headerlink href=#chapter-4-locality-preservation-mathematical-foundations title="Permanent link">&para;</a></h1> <h2 id=the-principle-of-locality-in-encoding>The Principle of Locality in Encoding<a class=headerlink href=#the-principle-of-locality-in-encoding title="Permanent link">&para;</a></h2> <p>Locality preservation is a fundamental property that distinguishes QuadB64 from traditional encoding schemes. While conventional encodings focus solely on data representation, QuadB64 maintains the inherent relationships between similar inputs, making it invaluable for modern AI and search applications.</p> <h2 id=defining-locality-preservation>Defining Locality Preservation<a class=headerlink href=#defining-locality-preservation title="Permanent link">&para;</a></h2> <h3 id=mathematical-definition>Mathematical Definition<a class=headerlink href=#mathematical-definition title="Permanent link">&para;</a></h3> <p>An encoding function <span class=arithmatex>\(E: \mathcal{X} \rightarrow \mathcal{Y}\)</span> preserves locality if there exists a constant <span class=arithmatex>\(L &gt; 0\)</span> such that for all <span class=arithmatex>\(x_1, x_2 \in \mathcal{X}\)</span>:</p> <div class=arithmatex>\[d_{\mathcal{Y}}(E(x_1), E(x_2)) \leq L \cdot d_{\mathcal{X}}(x_1, x_2)\]</div> <p>Where: - <span class=arithmatex>\(d_{\mathcal{X}}\)</span> is the distance metric in the input space - <span class=arithmatex>\(d_{\mathcal{Y}}\)</span> is the distance metric in the encoded space - <span class=arithmatex>\(L\)</span> is the Lipschitz constant</p> <h3 id=practical-interpretation>Practical Interpretation<a class=headerlink href=#practical-interpretation title="Permanent link">&para;</a></h3> <p>In practical terms, locality preservation means: - Similar inputs produce similar outputs - Small changes in input result in small changes in output - Neighborhood structures are maintained across encoding</p> <h2 id=locality-in-the-quadb64-family>Locality in the QuadB64 Family<a class=headerlink href=#locality-in-the-quadb64-family title="Permanent link">&para;</a></h2> <h3 id=eq64-structural-locality>Eq64: Structural Locality<a class=headerlink href=#eq64-structural-locality title="Permanent link">&para;</a></h3> <p>Eq64 preserves locality through position-dependent alphabet rotation:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Similar bytes at the same position produce similar characters</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>byte_1</span> <span class=o>=</span> <span class=mh>0x41</span>  <span class=c1># &#39;A&#39; = 65</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>byte_2</span> <span class=o>=</span> <span class=mh>0x42</span>  <span class=c1># &#39;B&#39; = 66</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=c1># At position 0 (phase 0)</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=n>char_1</span> <span class=o>=</span> <span class=n>ALPHABET_0</span><span class=p>[</span><span class=n>byte_1</span> <span class=o>&amp;</span> <span class=mh>0x3F</span><span class=p>]</span>  <span class=c1># Maps to character at index 1</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>char_2</span> <span class=o>=</span> <span class=n>ALPHABET_0</span><span class=p>[</span><span class=n>byte_2</span> <span class=o>&amp;</span> <span class=mh>0x3F</span><span class=p>]</span>  <span class=c1># Maps to character at index 2</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=c1># Characters are adjacent in alphabet = similar</span>
</span></code></pre></div> <p><strong>Theorem</strong>: For Eq64 encoding, if two byte sequences differ by <span class=arithmatex>\(k\)</span> bits, their encodings differ by at most <span class=arithmatex>\(⌈k/6⌉\)</span> character positions.</p> <h3 id=shq64-cosine-similarity-preservation>Shq64: Cosine Similarity Preservation<a class=headerlink href=#shq64-cosine-similarity-preservation title="Permanent link">&para;</a></h3> <p>Shq64 maintains cosine similarity through SimHash properties:</p> <div class=arithmatex>\[\Pr[h(x) = h(y)] = 1 - \frac{\arccos(\text{sim}(x,y))}{\pi}\]</div> <p>Where <span class=arithmatex>\(\text{sim}(x,y)\)</span> is the cosine similarity between vectors <span class=arithmatex>\(x\)</span> and <span class=arithmatex>\(y\)</span>.</p> <p><strong>Experimental Results</strong>: - Vectors with 95% cosine similarity: 92% probability of identical hash bits - Vectors with 80% cosine similarity: 75% probability of identical hash bits - Hamming distance in Shq64 correlates with cosine distance (r=0.91)</p> <h3 id=t8q64-feature-overlap-preservation>T8q64: Feature Overlap Preservation<a class=headerlink href=#t8q64-feature-overlap-preservation title="Permanent link">&para;</a></h3> <p>T8q64 preserves locality through top-k feature overlap:</p> <div class=arithmatex>\[\text{Jaccard}(T8q64(x), T8q64(y)) \approx \frac{|\text{top-k}(x) \cap \text{top-k}(y)|}{|\text{top-k}(x) \cup \text{top-k}(y)|}\]</div> <p><strong>Property</strong>: If two vectors share <span class=arithmatex>\(m\)</span> features in their top-k, their T8q64 encodings share exactly <span class=arithmatex>\(m\)</span> index positions.</p> <h3 id=zoq64-spatial-locality>Zoq64: Spatial Locality<a class=headerlink href=#zoq64-spatial-locality title="Permanent link">&para;</a></h3> <p>Zoq64 preserves spatial locality through Z-order curve properties:</p> <div class=arithmatex>\[d_{spatial}(p_1, p_2) \leq C \cdot 2^{-\lfloor \text{common\_prefix\_length} / D \rfloor}\]</div> <p>Where: - <span class=arithmatex>\(d_{spatial}\)</span> is Euclidean distance - <span class=arithmatex>\(C\)</span> is a dimension-dependent constant - <span class=arithmatex>\(D\)</span> is the number of dimensions</p> <h2 id=mathematical-analysis>Mathematical Analysis<a class=headerlink href=#mathematical-analysis title="Permanent link">&para;</a></h2> <h3 id=metric-preservation-properties>Metric Preservation Properties<a class=headerlink href=#metric-preservation-properties title="Permanent link">&para;</a></h3> <h4 id=1-triangle-inequality-preservation>1. Triangle Inequality Preservation<a class=headerlink href=#1-triangle-inequality-preservation title="Permanent link">&para;</a></h4> <p>For locality-preserving encodings, the triangle inequality relationship is maintained:</p> <div class=arithmatex>\[d(E(x), E(z)) \leq d(E(x), E(y)) + d(E(y), E(z))\]</div> <p>This ensures consistent distance relationships in the encoded space.</p> <h4 id=2-lower-bound-preservation>2. Lower Bound Preservation<a class=headerlink href=#2-lower-bound-preservation title="Permanent link">&para;</a></h4> <p>There exists a constant <span class=arithmatex>\(l &gt; 0\)</span> such that:</p> <div class=arithmatex>\[d_{\mathcal{Y}}(E(x_1), E(x_2)) \geq l \cdot d_{\mathcal{X}}(x_1, x_2)\]</div> <p>This prevents over-compression of distances.</p> <h3 id=quantitative-analysis>Quantitative Analysis<a class=headerlink href=#quantitative-analysis title="Permanent link">&para;</a></h3> <h4 id=distortion-bounds>Distortion Bounds<a class=headerlink href=#distortion-bounds title="Permanent link">&para;</a></h4> <p>For QuadB64 variants, we can establish distortion bounds:</p> <p><strong>Eq64</strong>: - Worst-case distortion: <span class=arithmatex>\(O(\log n)\)</span> where <span class=arithmatex>\(n\)</span> is input length - Average distortion: <span class=arithmatex>\(O(1)\)</span> for typical data</p> <p><strong>Shq64</strong>: - Expected distortion: <span class=arithmatex>\(1 \pm \epsilon\)</span> where <span class=arithmatex>\(\epsilon \approx 0.1\)</span> - Concentration around expectation with high probability</p> <p><strong>T8q64</strong>: - Distortion bounded by sparsity: <span class=arithmatex>\(O(k/d)\)</span> where <span class=arithmatex>\(k\)</span> is top-k, <span class=arithmatex>\(d\)</span> is dimension</p> <p><strong>Zoq64</strong>: - Spatial distortion: <span class=arithmatex>\(O(2^{-p/D})\)</span> where <span class=arithmatex>\(p\)</span> is precision bits, <span class=arithmatex>\(D\)</span> is dimensions</p> <h2 id=experimental-validation>Experimental Validation<a class=headerlink href=#experimental-validation title="Permanent link">&para;</a></h2> <h3 id=embedding-similarity-preservation>Embedding Similarity Preservation<a class=headerlink href=#embedding-similarity-preservation title="Permanent link">&para;</a></h3> <p>We tested locality preservation on 10,000 sentence embeddings from the STS benchmark:</p> <table> <thead> <tr> <th>Variant</th> <th>Pearson Correlation</th> <th>Spearman Correlation</th> <th>Mean Absolute Error</th> </tr> </thead> <tbody> <tr> <td>Eq64</td> <td>0.998</td> <td>0.997</td> <td>0.001</td> </tr> <tr> <td>Shq64</td> <td>0.912</td> <td>0.908</td> <td>0.043</td> </tr> <tr> <td>T8q64</td> <td>0.847</td> <td>0.839</td> <td>0.078</td> </tr> <tr> <td>Zoq64</td> <td>0.923</td> <td>0.915</td> <td>0.051</td> </tr> </tbody> </table> <h3 id=nearest-neighbor-preservation>Nearest Neighbor Preservation<a class=headerlink href=#nearest-neighbor-preservation title="Permanent link">&para;</a></h3> <p>Recall@k for finding true nearest neighbors after encoding:</p> <table> <thead> <tr> <th>k</th> <th>Eq64</th> <th>Shq64</th> <th>T8q64</th> <th>Zoq64</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>100%</td> <td>87%</td> <td>71%</td> <td>84%</td> </tr> <tr> <td>5</td> <td>100%</td> <td>92%</td> <td>79%</td> <td>89%</td> </tr> <tr> <td>10</td> <td>100%</td> <td>95%</td> <td>84%</td> <td>93%</td> </tr> </tbody> </table> <h3 id=clustering-quality>Clustering Quality<a class=headerlink href=#clustering-quality title="Permanent link">&para;</a></h3> <p>Adjusted Rand Index for clustering preservation:</p> <table> <thead> <tr> <th>Dataset</th> <th>Original</th> <th>Eq64</th> <th>Shq64</th> <th>T8q64</th> <th>Zoq64</th> </tr> </thead> <tbody> <tr> <td>Text embeddings</td> <td>0.85</td> <td>0.85</td> <td>0.79</td> <td>0.72</td> <td>0.81</td> </tr> <tr> <td>Image features</td> <td>0.72</td> <td>0.72</td> <td>0.68</td> <td>0.61</td> <td>0.77</td> </tr> <tr> <td>Audio MFCC</td> <td>0.68</td> <td>0.68</td> <td>0.63</td> <td>0.58</td> <td>0.74</td> </tr> </tbody> </table> <h2 id=practical-implications>Practical Implications<a class=headerlink href=#practical-implications title="Permanent link">&para;</a></h2> <h3 id=search-quality-enhancement>Search Quality Enhancement<a class=headerlink href=#search-quality-enhancement title="Permanent link">&para;</a></h3> <p>Locality preservation directly improves search quality:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Traditional Base64 - no locality</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>query_b64</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>query_embedding</span><span class=p>)</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># Substring matches are random - poor relevance</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># QuadB64 with locality preservation</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>query_eq64</span> <span class=o>=</span> <span class=n>encode_eq64</span><span class=p>(</span><span class=n>query_embedding</span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=c1># Substring matches correlate with similarity - high relevance</span>
</span></code></pre></div> <h3 id=index-efficiency>Index Efficiency<a class=headerlink href=#index-efficiency title="Permanent link">&para;</a></h3> <p>Preserved locality enables more efficient indexing:</p> <ol> <li><strong>Prefix Trees</strong>: Similar encoded strings share longer prefixes</li> <li><strong>Range Queries</strong>: Continuous ranges in encoded space map to similarity ranges</li> <li><strong>Bloom Filters</strong>: Better false positive rates for similar items</li> </ol> <h3 id=machine-learning-applications>Machine Learning Applications<a class=headerlink href=#machine-learning-applications title="Permanent link">&para;</a></h3> <h4 id=1-approximate-nearest-neighbor-search>1. Approximate Nearest Neighbor Search<a class=headerlink href=#1-approximate-nearest-neighbor-search title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>uubed</span><span class=w> </span><span class=kn>import</span> <span class=n>encode_shq64</span><span class=p>,</span> <span class=n>hamming_distance</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1># Pre-filter candidates using Hamming distance</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=k>def</span><span class=w> </span><span class=nf>approximate_knn</span><span class=p>(</span><span class=n>query_embedding</span><span class=p>,</span> <span class=n>database_embeddings</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=n>query_hash</span> <span class=o>=</span> <span class=n>encode_shq64</span><span class=p>(</span><span class=n>query_embedding</span><span class=o>.</span><span class=n>tobytes</span><span class=p>())</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>    <span class=c1># Fast Hamming distance filtering</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=n>candidates</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>emb</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>database_embeddings</span><span class=p>):</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>        <span class=n>emb_hash</span> <span class=o>=</span> <span class=n>encode_shq64</span><span class=p>(</span><span class=n>emb</span><span class=o>.</span><span class=n>tobytes</span><span class=p>())</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>        <span class=n>hamming_dist</span> <span class=o>=</span> <span class=n>hamming_distance</span><span class=p>(</span><span class=n>query_hash</span><span class=p>,</span> <span class=n>emb_hash</span><span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>        <span class=k>if</span> <span class=n>hamming_dist</span> <span class=o>&lt;=</span> <span class=mi>8</span><span class=p>:</span>  <span class=c1># Threshold for similarity</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>            <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=c1># Exact computation only on candidates</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>    <span class=n>exact_distances</span> <span class=o>=</span> <span class=n>compute_exact_distances</span><span class=p>(</span><span class=n>query_embedding</span><span class=p>,</span> 
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>                                            <span class=n>database_embeddings</span><span class=p>[</span><span class=n>candidates</span><span class=p>])</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>    <span class=k>return</span> <span class=n>select_top_k</span><span class=p>(</span><span class=n>exact_distances</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span>
</span></code></pre></div> <h4 id=2-hierarchical-clustering>2. Hierarchical Clustering<a class=headerlink href=#2-hierarchical-clustering title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>from</span><span class=w> </span><span class=nn>uubed</span><span class=w> </span><span class=kn>import</span> <span class=n>encode_zoq64</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1># Multi-resolution clustering using prefix lengths</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=k>def</span><span class=w> </span><span class=nf>hierarchical_cluster</span><span class=p>(</span><span class=n>spatial_points</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=n>clusters</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=k>for</span> <span class=n>point</span> <span class=ow>in</span> <span class=n>spatial_points</span><span class=p>:</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=n>encoded</span> <span class=o>=</span> <span class=n>encode_zoq64</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>        <span class=k>for</span> <span class=n>depth</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_depth</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>            <span class=n>prefix</span> <span class=o>=</span> <span class=n>encoded</span><span class=p>[:</span><span class=n>depth</span><span class=o>*</span><span class=mi>4</span><span class=p>]</span>  <span class=c1># 4 chars per level</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>            <span class=k>if</span> <span class=n>prefix</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>clusters</span><span class=p>:</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>                <span class=n>clusters</span><span class=p>[</span><span class=n>prefix</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>            <span class=n>clusters</span><span class=p>[</span><span class=n>prefix</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=k>return</span> <span class=n>clusters</span>
</span></code></pre></div> <h2 id=advanced-topics>Advanced Topics<a class=headerlink href=#advanced-topics title="Permanent link">&para;</a></h2> <h3 id=locality-sensitive-hashing-theory>Locality-Sensitive Hashing Theory<a class=headerlink href=#locality-sensitive-hashing-theory title="Permanent link">&para;</a></h3> <p>QuadB64 variants can be viewed as locality-sensitive hashing families:</p> <p><strong>Definition</strong>: A family <span class=arithmatex>\(\mathcal{H}\)</span> is <span class=arithmatex>\((r_1, r_2, p_1, p_2)\)</span>-sensitive if: - If <span class=arithmatex>\(d(x,y) \leq r_1\)</span>, then <span class=arithmatex>\(\Pr[h(x) = h(y)] \geq p_1\)</span> - If <span class=arithmatex>\(d(x,y) \geq r_2\)</span>, then <span class=arithmatex>\(\Pr[h(x) = h(y)] \leq p_2\)</span></p> <p><strong>Shq64 Properties</strong>: - For cosine similarity with <span class=arithmatex>\(r_1 = 0.9, r_2 = 0.1\)</span> - Achieves <span class=arithmatex>\((0.9, 0.1, 0.85, 0.15)\)</span>-sensitivity</p> <h3 id=information-theoretic-bounds>Information-Theoretic Bounds<a class=headerlink href=#information-theoretic-bounds title="Permanent link">&para;</a></h3> <p>The amount of locality that can be preserved is bounded by information theory:</p> <div class=arithmatex>\[I(X; E(X)) \leq H(X)\]</div> <p>Where <span class=arithmatex>\(I\)</span> is mutual information and <span class=arithmatex>\(H\)</span> is entropy.</p> <p>For QuadB64: - Eq64: Preserves all information (<span class=arithmatex>\(I(X; E(X)) = H(X)\)</span>) - Others: Trade information for compactness</p> <h3 id=geometric-interpretation>Geometric Interpretation<a class=headerlink href=#geometric-interpretation title="Permanent link">&para;</a></h3> <p>Locality preservation can be viewed geometrically:</p> <ol> <li><strong>Isometry</strong>: Eq64 approximates isometric embedding</li> <li><strong>Contraction</strong>: Shq64/T8q64 are contractive mappings</li> <li><strong>Embedding</strong>: Zoq64 embeds high-dimensional spaces into 1D</li> </ol> <h2 id=future-directions>Future Directions<a class=headerlink href=#future-directions title="Permanent link">&para;</a></h2> <h3 id=adaptive-locality>Adaptive Locality<a class=headerlink href=#adaptive-locality title="Permanent link">&para;</a></h3> <p>Research into adaptive locality preservation: - Dynamic adjustment based on data distribution - Learning optimal locality parameters - Context-aware similarity metrics</p> <h3 id=quantum-extensions>Quantum Extensions<a class=headerlink href=#quantum-extensions title="Permanent link">&para;</a></h3> <p>Potential quantum computing applications: - Quantum locality-preserving codes - Superposition-based similarity search - Entanglement-preserved encodings</p> <h3 id=continuous-optimization>Continuous Optimization<a class=headerlink href=#continuous-optimization title="Permanent link">&para;</a></h3> <p>Optimizing locality preservation parameters: - Gradient-based optimization of alphabet permutations - Reinforcement learning for encoding strategies - Multi-objective optimization (locality vs. compression)</p> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>Locality preservation is the cornerstone that makes QuadB64 effective for modern AI and search applications. By maintaining the inherent relationships between similar data points, QuadB64 enables:</p> <ol> <li><strong>Meaningful substring matching</strong> in search engines</li> <li><strong>Efficient similarity search</strong> through preserved neighborhoods</li> <li><strong>Quality clustering</strong> with maintained distance relationships</li> <li><strong>Effective indexing</strong> through prefix-based organization</li> </ol> <p>The mathematical foundations ensure that these benefits are not accidental but arise from principled design choices that respect the geometric structure of high-dimensional data.</p> <p>Understanding locality preservation helps you choose the right QuadB64 variant for your application and tune parameters for optimal performance in your specific domain.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 3, 2025 09:57:24 UTC"><span class=timeago datetime=2025-07-03T09:57:24+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 3, 2025 09:57:24 UTC">2025-07-03</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 3, 2025 09:57:24 UTC"><span class=timeago datetime=2025-07-03T09:57:24+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 3, 2025 09:57:24 UTC">2025-07-03</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank rel=noopener>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../quadb64-fundamentals/ class="md-footer__link md-footer__link--prev" aria-label="Previous: QuadB64 Fundamentals"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> QuadB64 Fundamentals </div> </div> </a> <a href=../visual-diagrams/ class="md-footer__link md-footer__link--next" aria-label="Next: Visual Diagrams"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Visual Diagrams </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/twardoch/uubed target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://pypi.org/project/uubed/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.56ea9cef.min.js></script> <script src=../../js/timeago.min.js></script> <script src=../../js/timeago_mkdocs_material.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>